<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…±æœ‰ã‚¿ã‚¤ãƒãƒ¼</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ¡ã‚¤ãƒ³CDNãŒå¤±æ•—ã—ãŸå ´åˆã®ä»£æ›¿CDN
        if (typeof io === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"><\/script>');
        }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 40px;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            background: white;
            border: 1px solid #ddd;
            border-radius: 16px;
            padding: 60px;
            text-align: center;
        }
        
        h1 {
            margin: 0 0 50px 0;
            font-size: 3.5em;
            font-weight: normal;
        }
        
        .timer-display {
            font-size: 8em;
            font-family: monospace;
            margin: 50px 0;
            color: #333;
            line-height: 1;
        }
        
        .time-input {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
        }
        
        .time-input input {
            width: 100px;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5em;
        }
        
        .time-input label {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 1.4em;
        }
        
        .button {
            background: #007cba;
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 1.4em;
            min-width: 120px;
        }
        
        .button:hover:not(:disabled) {
            background: #005a8b;
        }
        
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            margin: 25px 0;
            padding: 15px;
            font-size: 1.2em;
            border-radius: 8px;
        }
        
        .status.running {
            background: #e8f5e8;
            color: #2d5a2d;
        }
        
        .status.paused {
            background: #fff8e1;
            color: #8a6914;
        }
        
        .status.stopped {
            background: #ffeaea;
            color: #8b2635;
        }
        
        .status.finished {
            background: #e3f2fd;
            color: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ã‚¿ã‚¤ãƒãƒ¼</h1>
        
        <div class="timer-display" id="timerDisplay">00:00</div>
        
        <div class="status" id="statusDisplay">åœæ­¢ä¸­</div>
        
        <div class="time-input">
            <label>
                <input type="number" id="minutesInput" min="0" max="59" value="5">
                åˆ†
            </label>
            <label>
                <input type="number" id="secondsInput" min="0" max="59" value="0">
                ç§’
            </label>
        </div>
        
        <div>
            <button class="button" id="startBtn" onclick="startTimer()">é–‹å§‹</button>
            <button class="button" id="pauseBtn" onclick="pauseTimer()" disabled>ä¸€æ™‚åœæ­¢</button>
            <button class="button" id="resumeBtn" onclick="resumeTimer()" disabled>å†é–‹</button>
            <button class="button" id="stopBtn" onclick="stopTimer()" disabled>åœæ­¢</button>
        </div>
    </div>

    <script>
        // Socket.IOã®èª­ã¿è¾¼ã¿ç¢ºèª
        if (typeof io === 'undefined') {
            alert('Socket.IOãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
            throw new Error('Socket.IO library failed to load');
        }
        
        const socket = io();
        
        let timerState = {
            isRunning: false,
            remainingTime: 0
        };
        
        // æ¥ç¶šçŠ¶æ…‹ã®ç®¡ç†ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã¿ï¼‰
        socket.on('connect', function() {
            console.log('Connected to server');
        });
        
        socket.on('disconnect', function() {
            console.log('Disconnected from server');
        });
        
        // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        socket.on('timer_update', function(data) {
            timerState.remainingTime = data.remaining_time;
            timerState.isRunning = data.is_running;
            updateDisplay();
            updateButtons();
        });
        
        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        socket.on('timer_started', function(data) {
            timerState.isRunning = true;
            timerState.remainingTime = data.remaining_time;
            updateDisplay();
            updateButtons();
            updateStatus('å®Ÿè¡Œä¸­', 'running');
        });
        
        // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
        socket.on('timer_stopped', function() {
            timerState.isRunning = false;
            timerState.remainingTime = 0;
            updateDisplay();
            updateButtons();
            updateStatus('åœæ­¢ä¸­', 'stopped');
        });
        
        // ã‚¿ã‚¤ãƒãƒ¼ä¸€æ™‚åœæ­¢
        socket.on('timer_paused', function(data) {
            timerState.isRunning = false;
            timerState.remainingTime = data.remaining_time;
            updateDisplay();
            updateButtons();
            updateStatus('ä¸€æ™‚åœæ­¢ä¸­', 'paused');
        });
        
        // ã‚¿ã‚¤ãƒãƒ¼å†é–‹
        socket.on('timer_resumed', function(data) {
            timerState.isRunning = true;
            timerState.remainingTime = data.remaining_time;
            updateDisplay();
            updateButtons();
            updateStatus('å®Ÿè¡Œä¸­', 'running');
        });
        
        // ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†
        socket.on('timer_finished', function() {
            timerState.isRunning = false;
            timerState.remainingTime = 0;
            updateDisplay();
            updateButtons();
            updateStatus('ğŸ‰ æ™‚é–“ã§ã™ï¼', 'finished');
            
            // é€šçŸ¥éŸ³ã‚„ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥æ©Ÿèƒ½ï¼‰
            if (Notification.permission === 'granted') {
                new Notification('ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†ï¼', {
                    body: 'è¨­å®šã—ãŸæ™‚é–“ãŒçµŒéã—ã¾ã—ãŸã€‚',
                    icon: '/favicon.ico'
                });
            }
            
            // ç°¡å˜ãªã‚¢ãƒ©ãƒ¼ãƒˆéŸ³
            playAlertSound();
        });
        
        function updateDisplay() {
            const minutes = Math.floor(timerState.remainingTime / 60);
            const seconds = Math.floor(timerState.remainingTime % 60);
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }
        
        function updateButtons() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resumeBtn = document.getElementById('resumeBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (timerState.isRunning) {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                resumeBtn.disabled = true;
                stopBtn.disabled = false;
            } else if (timerState.remainingTime > 0) {
                startBtn.disabled = true;
                pauseBtn.disabled = true;
                resumeBtn.disabled = false;
                stopBtn.disabled = false;
            } else {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                resumeBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }
        
        function updateStatus(text, className) {
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.textContent = text;
            statusDisplay.className = `status ${className}`;
        }
        
        function startTimer() {
            const minutes = parseInt(document.getElementById('minutesInput').value) || 0;
            const seconds = parseInt(document.getElementById('secondsInput').value) || 0;
            
            if (minutes === 0 && seconds === 0) {
                alert('æ™‚é–“ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            socket.emit('start_timer', {
                minutes: minutes,
                seconds: seconds
            });
        }
        
        function pauseTimer() {
            socket.emit('pause_timer');
        }
        
        function resumeTimer() {
            socket.emit('resume_timer');
        }
        
        function stopTimer() {
            socket.emit('stop_timer');
        }
        
        function playAlertSound() {
            // Web APIã‚’ä½¿ç”¨ã—ã¦ãƒ“ãƒ¼ãƒ—éŸ³ã‚’ç”Ÿæˆ
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
        }
        
        // é€šçŸ¥ã®è¨±å¯ã‚’æ±‚ã‚ã‚‹
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // åˆæœŸçŠ¶æ…‹ã®æ›´æ–°
        updateDisplay();
        updateButtons();
    </script>
</body>
</html>
